(this["webpackJsonpcowin-vaccine"]=this["webpackJsonpcowin-vaccine"]||[]).push([[0],{121:function(e,t,n){"use strict";n.r(t);var i=n(1),a=n(0),s=n.n(a),o=n(14),c=n.n(o),r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function l(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"}),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var d=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,133)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),s(e),o(e)}))},u=(n(89),n(90),n(12)),h=n(13),p=n(6),b=n(16),m=n(15),O=n(54),j=n(9),g=(n(91),n(132)),_=n(128),v=n(125),f=n(131),k=n(129),C=n(126),S=n(127),y=n(30),x=n(17),N=n.n(x),T=n(8),w=n(46),E=n(24),I=n.n(E),A=n(18),D="SET_USER_TOKEN",R="SET_SERVER_STAT",B="SET_USER_SUBSCRIPTION",L=function(e){return{type:D,payload:e}},M=function(e){return{type:B,payload:e}},U=n(123),G=n(124),P=n(27),F=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(u.a)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={week:[0,1,2,3,4,5,6].map((function(e){return I()().add(e,"day").format("DD-MM-YY")}))},e}return Object(h.a)(n,[{key:"OnChangeDate",value:function(e){this.setState({week:[0,1,2,3,4,5,6].map((function(t){return I()(e,"YYYY-MM-DD").add(t,"day").format("DD-MM-YY")}))})}},{key:"render",value:function(){var e=this;return Object(i.jsxs)("div",{className:"bg-white shadow rounded-lg mt-2 overflow-hidden p-0",children:[this.props.vaccine.centers.length>0&&Object(i.jsxs)(U.a,{striped:!0,bordered:!0,hover:!0,children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"Name"}),this.state.week.map((function(e){return Object(i.jsx)("th",{children:e},"th-"+e)}))]})}),Object(i.jsx)("tbody",{children:this.props.vaccine.centers.map((function(t){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{className:"font-weight-bolder",children:[t.name,Object(i.jsxs)("sup",{className:"small",children:[" ",Object(i.jsx)(G.a,{variant:"secondary",children:t.fee_type})]})]}),Object(i.jsxs)("p",{className:"text-secondary small m-0",children:[t.address,", ",t.block_name]}),Object(i.jsxs)("p",{className:"text-secondary small m-0",children:[t.district_name,", ",t.state_name,", ",t.pincode]})]})}),e.state.week.map((function(e){var n=t.sessions.findIndex((function(t){return t.date===I()(e,"DD-MM-YY").format("DD-MM-YYYY")}));return n>=0?Object(i.jsx)("td",{children:Object(i.jsxs)("div",{children:[Object(i.jsx)("span",{className:"",children:t.sessions[n].vaccine}),Object(i.jsxs)("p",{className:"small m-0 text-danger",children:["For ",t.sessions[n].min_age_limit,"+"]}),t.sessions[n].available_capacity?Object(i.jsx)("a",{href:P.COWIN_REGISTRATION,target:"_blank",rel:"noreferrer",children:Object(i.jsxs)(v.a,{variant:"success p-1","data-toggle":"tooltip","data-placement":"top",title:"Tooltip on top",children:["Book ",Object(i.jsx)("sup",{children:Object(i.jsx)(G.a,{variant:"primary",children:t.sessions[n].available_capacity})})]})}):Object(i.jsx)(v.a,{variant:"danger p-0",children:"Booked"})]})},t.sessions[n].session_id):Object(i.jsx)("td",{},Math.random())}))]},t.center_id)}))})]}),this.props.vaccine.centers.length<=0&&Object(i.jsx)("div",{className:"text-center font-weight-bold p-4",children:"No centers are available for now, try to search for another pin code."})]})}}]),n}(a.Component),W=Object(A.b)((function(e){return{user:e.user,vaccine:e.vaccine}}),(function(e){return{setToken:function(t){return e(L(t))}}}))(F),Y=n(83),V=n(47),K=n.n(V),z=n(44),H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Event Category";return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"action",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";z.a.event({category:e,action:t,label:n})}},q=n(78),J=n.n(q),X=n(19),Q=n(79),Z=function(e){return Object(i.jsxs)(v.a,{onClick:e.onClick,disabled:e.disabled,variant:"primary",className:"shadow my-1",children:[Object(i.jsx)(Q.a,{icon:"comment-dots",size:"3x"}),Object(i.jsx)("div",{children:e.text||"Login and subscribe SMS notification"})]})},$=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={mobile_number:"",is_valid_mobile:!1,show_mobile_input:!1,submitting_mobile:!1},a.options={headers:{"Content-Type":"application/json",Authorization:"Token "+a.props.user.token}},a.GetButton=function(){return a.props.user.subscriptions&&a.props.user.subscriptions.includes(P.SUBSCRIPTION_WA)?Object(i.jsx)(Z,{text:"Unsubscribe text SMS notification",onClick:a.OnWaSubscriptionBtnToggle}):Object(i.jsx)(Z,{text:"Subscribe text SMS notification",onClick:a.OnWaSubscriptionBtnToggle})},a.OnWaSubscriptionBtnToggle=a.OnWaSubscriptionBtnToggle.bind(Object(p.a)(a)),a.OnMobileChange=a.OnMobileChange.bind(Object(p.a)(a)),a.OnSubmitMobile=a.OnSubmitMobile.bind(Object(p.a)(a)),a}return Object(h.a)(n,[{key:"IsSubscriptionContainsWa",value:function(){return this.props.user.subscriptions&&this.props.user.subscriptions.includes(P.SUBSCRIPTION_WA)}},{key:"OnSubmitMobile",value:function(){var e=this;if(!this.IsSubscriptionContainsWa()){this.setState({submitting_mobile:!0});var t={subscription:P.SUBSCRIPTION_WA,mobile:this.state.mobile_number};N.a.post(T.BACKEND_BASE_URL+X.NOTIFICATION_SUBSCRIBED_URL,t,this.options).then((function(t){if("success"===t.data.status||"you already subscribed"===t.data.message){var n=e.props.user.subscriptions;e.props.callback&&e.props.callback(t.data.message),n&&(n.push(P.SUBSCRIPTION_WA),e.props.setSubscriptions(n))}else e.setState({submitting_mobile:!1,show_mobile_input:!1})})).catch((function(t){console.log(t),e.setState({submitting_mobile:!1})}))}}},{key:"OnWaSubscriptionBtnToggle",value:function(){var e=this;if(this.IsSubscriptionContainsWa()){var t={subscription:P.SUBSCRIPTION_WA};N.a.post(T.BACKEND_BASE_URL+X.NOTIFICATION_UNSUBSCRIBED_URL,t,this.options).then((function(t){if("success"===t.data.status){var n=e.props.user.subscriptions;n&&(n[n.indexOf(P.SUBSCRIPTION_WA)]=n[n.length-1],n.pop(),e.props.setSubscriptions(n))}})).catch((function(e){console.log(e)}))}else this.setState({show_mobile_input:!0})}},{key:"OnMobileChange",value:function(e){var t=e.target.value.replace(/^0+/,"");this.setState({mobile_number:t,is_valid_mobile:10===e.target.value.length})}},{key:"render",value:function(){return Object(i.jsx)("div",{children:this.state.show_mobile_input?Object(i.jsxs)("div",{className:"shadow rounded-lg p-1 border-primary border",children:[Object(i.jsx)(g.a,{className:"no-input-shadow",placeholder:"Enter mobile number",type:"number",value:this.state.mobile_number,onChange:this.OnMobileChange,disabled:this.state.submitting_mobile}),Object(i.jsx)(v.a,{varient:"primary",style:{width:"100%"},className:"mt-2",disabled:!this.state.is_valid_mobile||this.state.submitting_mobile,onClick:this.OnSubmitMobile,children:" Subscribe SMS "})]}):Object(i.jsx)(this.GetButton,{})})}}]),n}(a.Component),ee=Object(A.b)((function(e){return{user:e.user}}),(function(e){return{setSubscriptions:function(t){return e(M(t))}}}))($),te="SET_CENTERS",ne="SET_TRACKING_CENTER",ie="CENTER_UPDATE_DONE",ae="SET_NEARBY_CENTERS",se=function(e){return{type:ne,payload:e}},oe=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).state={is_google_login_supported:!0},i.GaEventTracker=H(),i.responseGoogle=function(e){i.GaEventTracker("AUTH 2.0 success"),"idpiframe_initialization_failed"===e.error&&i.setState({is_google_login_supported:!1}),e.accessToken&&i.exchangeToken(e.accessToken)},i.responseGoogle=i.responseGoogle.bind(Object(p.a)(i)),i.exchangeToken=i.exchangeToken.bind(Object(p.a)(i)),i}return Object(h.a)(n,[{key:"exchangeToken",value:function(e){var t=this;N.a.post(T.BACKEND_BASE_URL+X.GET_TOKEN_URL,{access_token:e},{headers:{"Content-type":"application/json"}}).then((function(e){t.props.setToken(e.data.token),t.props.getUser()})).catch((function(e){t.GaEventTracker("Fail GET User",e),console.log(e)}))}},{key:"render",value:function(){return this.state.is_google_login_supported?this.props.user.token?Object(i.jsx)(ee,{callback:this.props.onSubscriptionResponseCallback}):Object(i.jsx)(J.a,{clientId:T.GMAIL_API_CLIENT_ID,render:Z,buttonText:"Login",onSuccess:this.responseGoogle,onFailure:this.responseGoogle,cookiePolicy:"single_host_origin",isSignedIn:!0}):Object(i.jsx)("div",{className:"bg-white rounded-lg p-2 red-shadow btn my-1",children:"Google Login not supported, please try another browser or close icognito mode."})}}]),n}(a.Component),ce=Object(A.b)((function(e){return{user:e.user,vaccine:e.vaccine}}),(function(e){return{setToken:function(t){return e(L(t))},setSubscriptions:function(t){return e(M(t))},setTrackingCenter:function(t){return e(se(t))}}}))(oe),re=n.p+"static/media/map.4ffa6cad.jpg",le=H();function de(e,t){le("Total cowin-api requests",e),fetch(e).then((function(e){return e.json()})).then((function(e){return t(e.centers)}))}var ue=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).state={my_position:{lat:12.97,lng:77.59},map_center:{lat:12.97,lng:77.59},map_zoom:12,maps_data:{},show_map:!1,markers:[]},i.GaEventTracker=H(),i.HandleApiLoaded=function(e,t){i.setState({maps_data:{map:e,maps:t}})},i.OnClickCenterBox=i.OnClickCenterBox.bind(Object(p.a)(i)),i.LocateMyPosition=i.LocateMyPosition.bind(Object(p.a)(i)),i.OnGetNearbyCenterCallback=i.OnGetNearbyCenterCallback.bind(Object(p.a)(i)),i.DrawMarkersOnMap=i.DrawMarkersOnMap.bind(Object(p.a)(i)),i.GetNumber=i.GetNumber.bind(Object(p.a)(i)),i.SetMyPosition=i.SetMyPosition.bind(Object(p.a)(i)),i}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){e.setState({my_position:{lat:t.coords.latitude,lng:t.coords.longitude},map_center:{lat:t.coords.latitude,lng:t.coords.longitude}}),e.SubmitLatLong(t.coords)}))}},{key:"SubmitLatLong",value:function(e){e&&de(T.COWIN_BASE_URL+y.CENTERS_BY_LAT_LONG.replace("<LAT>",e.latitude).replace("<LONG>",e.longitude),this.OnGetNearbyCenterCallback)}},{key:"OnGetNearbyCenterCallback",value:function(e){this.props.setNearbyCenter(e),this.GaEventTracker("Received Nearby Centers"),this.setState({show_map:!0}),this.DrawMarkersOnMap()}},{key:"LocateMyPosition",value:function(){this.setState({map_center:this.state.my_position,map_zoom:13})}},{key:"DrawMarkersOnMap",value:function(){var e=this;if(this.state.maps_data.map){this.SetMyPosition();var t=this.state.maps_data.map;this.props.vaccine.nearby_centers.forEach((function(n){var i={lat:e.GetNumber(n.lat),lng:e.GetNumber(n.long)},a=new e.state.maps_data.maps.Marker({position:i,map:t,title:n.name,label:{text:"H",color:"white",fontWeight:"bold"}});a.addListener("click",(function(){a.setAnimation(e.state.maps_data.maps.Animation.BOUNCE),setTimeout((function(){a.setAnimation(null)}),2e3)})),a.addListener("mouseover",(function(){var t=K()("#center-"+n.center_id).parent(),i=K()(".center-parent"),a=t.offset().top+i.scrollTop()-t.parent().offset().top;i.animate({scrollTop:a},500),e.SetActiveCenterBox(n.center_id)})),e.state.markers.push(a)}))}else setTimeout(this.DrawMarkersOnMap,500)}},{key:"SetMyPosition",value:function(){var e=this,t=this.state.maps_data.maps,n=this.state.maps_data.map,i=new this.state.maps_data.maps.Marker({position:this.state.my_position,animation:t.Animation.DROP,map:n,icon:{url:"https://w7.pngwing.com/pngs/81/570/png-transparent-profile-logo-computer-icons-user-user-blue-heroes-logo-thumbnail.png",scaledSize:new t.Size(16,16)},title:"Me"});i.addListener("click",(function(){i.setAnimation(e.state.maps_data.maps.Animation.BOUNCE),setTimeout((function(){i.setAnimation(null)}),2e3)}))}},{key:"GetNumber",value:function(e){return Number(parseFloat(e).toFixed(5))}},{key:"SetDirection",value:function(e){this.GaEventTracker("Google map directions requests");var t=new this.state.maps_data.maps.DirectionsService,n=new this.state.maps_data.maps.DirectionsRenderer;n.setMap(this.state.maps_data.map);var i={lat:this.GetNumber(e.lat),lng:this.GetNumber(e.long)},a={origin:this.state.my_position,destination:i,travelMode:this.state.maps_data.maps.TravelMode.DRIVING};t.route(a,(function(e,t){"OK"===t&&n.setDirections(e)}))}},{key:"SetActiveCenterBox",value:function(e){K()(".center-box").removeClass("border-primary blue-shadow"),K()("#center-"+e).addClass("border-primary blue-shadow")}},{key:"OnClickCenterBox",value:function(e){this.SetActiveCenterBox(e.center_id);var t={lat:parseFloat(e.lat),lng:parseFloat(e.long)};this.setState({map_center:t,map_zoom:14})}},{key:"GetFormattedDate",value:function(e){return I()(e,"DD-MM-YYYY").format("DD MMM")}},{key:"render",value:function(){var e=this;return Object(i.jsx)("section",{children:Object(i.jsxs)(C.a,{children:[Object(i.jsx)(S.a,{md:9,className:"",children:this.state.show_map>0?Object(i.jsxs)("div",{style:{height:600,width:"100%"},className:"shadow position-relative rounded-lg overflow-hidden",children:[Object(i.jsx)(Y.a,{bootstrapURLKeys:{key:T.GOOGLE_MAP_API,language:"en"},defaultCenter:{lat:12.97,lng:77.59},center:this.state.map_center,defaultZoom:10,zoom:this.state.map_zoom,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(t){var n=t.map,i=t.maps;return e.HandleApiLoaded(n,i)},onChildMouseEnter:this.OnMouseHoverOnHospital}),Object(i.jsx)(v.a,{variant:"light",className:"my-location position-absolute shadow",style:{right:10,bottom:150,height:38,width:38,borderRadius:38},onClick:this.LocateMyPosition,children:"+"})]}):Object(i.jsxs)("div",{style:{height:600,width:"100%"},className:"shadow position-relative rounded-lg overflow-hidden",children:[Object(i.jsx)("img",{src:re,height:"100%",alt:"map"}),Object(i.jsx)("div",{style:{height:"100%",width:"100%",top:0,background:"rgba(0,0,0, 0.5)"},className:"p-2 position-absolute text-white font-weight-bold d-flex justify-content-center align-items-center",children:"Allow location, to get centers nearby you"})]})}),Object(i.jsxs)(S.a,{md:3,style:{maxHeight:600,overflowY:"auto"},className:"center-parent",children:[this.props.user.is_server_up&&!(this.props.user.subscriptions&&this.props.user.subscriptions.includes(P.SUBSCRIPTION_WA))&&Object(i.jsx)(ce,{getUser:this.props.getUser,onSubscriptionResponseCallback:this.props.onSubscriptionResponseCallback}),0===this.props.vaccine.nearby_centers.length&&Object(i.jsx)(S.a,{className:"p-0 py-1",children:Object(i.jsx)("div",{className:"p-2 shadow rounded-lg border center-box bg-white btn font-weight-bold my-1",style:{width:"100%"},children:"No centers are available now"})}),this.props.vaccine.nearby_centers.map((function(t){return Object(i.jsx)(S.a,{className:"p-0 py-1",children:Object(i.jsxs)("div",{className:"p-1 shadow rounded-lg border center-box bg-white",id:"center-"+t.center_id,onClick:function(){e.OnClickCenterBox(t)},children:[Object(i.jsx)("b",{children:t.name}),Object(i.jsxs)("p",{className:"text-secondary small m-0",children:[t.location,", ",t.block_name]}),Object(i.jsxs)("p",{className:"text-secondary small m-0",children:[t.district_name,", ",t.state_name,", ",t.pincode]}),Object(i.jsx)("div",{className:"text-primary btn px-0 small",onClick:function(){e.SetDirection(t)},style:{fontSize:11},children:"Show direction on map"}),Object(i.jsx)("div",{children:e.props.isTrackingContains(Number(t.pincode))?"":Object(i.jsx)(G.a,{variant:"primary",className:"btn p-1 m-1",onClick:function(){e.props.addToTracking(Number(t.pincode))},children:" Set Tracking"})})]})},"center-"+t.center_id)}))]})]})})}}]),n}(a.Component),he=Object(A.b)((function(e){return{user:e.user,vaccine:e.vaccine}}),(function(e){return{setToken:function(t){return e(L(t))},setNearbyCenter:function(t){return e(function(e){return{type:ae,payload:e}}(t))},setTrackingCenters:function(t){return e(se(t))},setCentersUpdateDone:function(){return e({type:ie,is_centers_updated:!1})}}}))(ue),pe=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return Object(i.jsxs)("div",{className:"shadow p-1 rounded-lg bg-white my-1",children:[this.props.vaccine.tracking_centers&&this.props.vaccine.tracking_centers.length>0?Object(i.jsx)("h6",{className:"font-weight-bold btn",children:" Tracking pin codes 18-45"}):Object(i.jsx)("h6",{className:"font-weight-bold btn",children:" No notification trackers "}),Object(i.jsx)("hr",{}),this.props.vaccine.tracking_centers&&this.props.vaccine.tracking_centers.map((function(t){return Object(i.jsxs)("div",{className:"rounded p-2 m-1 font-weight-bold bg-cowin2 position-relative overflow-hidden",children:[t.pin_code,Object(i.jsx)(v.a,{variant:"danger",onClick:function(){e.props.removeFromTracking(t.pin_code)},className:"float-right  position-absolute rounded-0",style:{top:0,right:0,height:"100%"},children:" X "})]},"center-tr-"+t.pin_code)}))]})}}]),n}(a.Component),be=Object(A.b)((function(e){return{user:e.user,vaccine:e.vaccine}}),(function(e){return{setTrackingCenters:function(t){return e(se(t))}}}))(pe),me=n(38),Oe={name:"cowin",version:T.DB_VERSION,objectStoresMeta:[{store:"centers",storeConfig:{keyPath:"pin_code"},storeSchema:[{name:"pin_code",keypath:"pin_code",options:{unique:!0}}]}]},je=H();function ge(){return(0,Object(me.useIndexedDB)("centers").getAll)()}function _e(e){return je("[SW] Center Added",e),(0,Object(me.useIndexedDB)("centers").add)({pin_code:e})}var ve=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).IsTrackingContains=i.IsTrackingContains.bind(Object(p.a)(i)),i.RemoveFromTracking=i.RemoveFromTracking.bind(Object(p.a)(i)),i.RemovePinCodeFromBackend=i.RemovePinCodeFromBackend.bind(Object(p.a)(i)),i.SetTrackingCentersFromDbIndex=i.SetTrackingCentersFromDbIndex.bind(Object(p.a)(i)),i.SyncPinCodeWithBackend=i.SyncPinCodeWithBackend.bind(Object(p.a)(i)),i.GetUser=i.GetUser.bind(Object(p.a)(i)),i.AddToTracking=i.AddToTracking.bind(Object(p.a)(i)),i.SetTrackingCentersFromDbIndex(),i}return Object(h.a)(n,[{key:"SetTrackingCentersFromDbIndex",value:function(){var e=this;ge().then((function(t){e.props.setTrackingCenters(t)}))}},{key:"GetUser",value:function(){var e=this,t=T.BACKEND_BASE_URL+X.GET_USER_INFO,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};N.a.post(t,{},n).then((function(t){e.props.setSubscriptions(t.data.subscriptions),e.SyncPinCodeWithBackend(t.data.pin_codes)})).catch((function(t){e.GaEventTracker("Fail GET User",t),console.log(t)}))}},{key:"SyncPinCodeWithBackend",value:function(){var e=this;if(this.props.user.token){var t=T.BACKEND_BASE_URL+X.SYNC_PIN_CODE_URL,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};ge().then((function(i){N.a.post(t,{pin_codes:i.map((function(e){return e.pin_code}))},n).then((function(t){(0,Object(me.useIndexedDB)("centers").clear)().then((function(){t.data.pin_codes.forEach((function(e){_e(e)})),e.SetTrackingCentersFromDbIndex()}))})).catch((function(e){console.log(e)}))}))}}},{key:"IsTrackingContains",value:function(e){return this.props.vaccine.tracking_centers.findIndex((function(t){return t.pin_code===e}))>=0}},{key:"RemovePinCodeFromBackend",value:function(e){var t=T.BACKEND_BASE_URL+X.REMOVE_PIN_CODE_URL,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};N.a.post(t,{pin_code:e},n).then((function(e){console.debug(e)})).catch((function(e){console.log(e)}))}},{key:"RemoveFromTracking",value:function(e){if(this.IsTrackingContains(e)){!function(e){var t=Object(me.useIndexedDB)("centers").deleteRecord;ge().then((function(n){n.forEach((function(n){if(n.pin_code===e)return t(n.pin_code)}))}))}(e);for(var t=this.props.vaccine.tracking_centers,n=t.findIndex((function(t){return t.pin_code===e}));n<t.length-1;n++)t[n]=t[n+1];t.pop(),console.log(t),this.props.setTrackingCenters(t),this.RemovePinCodeFromBackend(e)}}},{key:"AddToTracking",value:function(e){if(this.props.vaccine.tracking_centers.length>3)try{this.onSubscriptionResponseCallback("Allowed max 4 tracking centers, please delete some to add new one. Thanks!")}catch(n){console.log("Error: ",n)}else if(!this.IsTrackingContains(e)){_e(e);var t=this.props.vaccine.tracking_centers;t.push({pin_code:e}),this.props.setTrackingCenters(t),this.AddCentersToBackend(e)}}},{key:"AddCentersToBackend",value:function(e){var t=T.BACKEND_BASE_URL+X.ADD_PIN_CODE_URL,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};N.a.post(t,{pin_code:e},n).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}}]),n}(a.Component),fe=n(130);var ke=function(e){var t=e.showModal,n=e.handleClose,a=e.textBody;return Object(i.jsxs)(fe.a,{show:t,onHide:n,children:[Object(i.jsx)(fe.a.Header,{closeButton:!0,children:Object(i.jsx)(fe.a.Title,{children:" Notification"})}),Object(i.jsx)(fe.a.Body,{children:a})]})},Ce=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).state={is_valid_feedback:!1,is_feedback_btn_disabled:!0,feedback_text:""},i.GaEventTracker=H(),i.OnSubmitFeedback=i.OnSubmitFeedback.bind(Object(p.a)(i)),i.OnChangeFeedback=i.OnChangeFeedback.bind(Object(p.a)(i)),i}return Object(h.a)(n,[{key:"OnSubmitFeedback",value:function(){var e=this;this.setState({is_valid_feedback:!0});var t=T.BACKEND_BASE_URL+X.USER_FEEDBACK,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};N.a.post(t,{feedback:this.state.feedback_text},n).then((function(e){console.debug(e)})).catch((function(t){e.setState({is_valid_feedback:!1}),e.GaEventTracker("Failed Feedback",t),console.log(t)}))}},{key:"OnChangeFeedback",value:function(e){var t=e.target.value;this.setState({feedback_text:t,is_feedback_btn_disabled:t.length<10})}},{key:"render",value:function(){return Object(i.jsx)("section",{className:"p-0",children:Object(i.jsx)("div",{className:"shadow bg-white p-4 my-2 rounded-lg",children:Object(i.jsxs)(C.a,{children:[Object(i.jsxs)(S.a,{children:[Object(i.jsx)("div",{className:"font-weight-bold",children:"Contact"}),Object(i.jsx)("a",{href:"https://www.linkedin.com/feed/update/urn%3Ali%3Aactivity%3A6798913715489120256/",target:"_blank",rel:"noreferrer",className:"no-text-decor",children:Object(i.jsxs)("div",{className:"text-primary",style:{fontWeight:800,fontSize:20},children:["Linked ",Object(i.jsx)("span",{className:"bg-primary text-white rounded-sm",style:{padding:"1px 2px 1px 2px"},children:"in"})]})})]}),this.props.user.is_server_up&&Object(i.jsxs)(S.a,{children:[Object(i.jsx)("div",{className:"font-weight-bold",children:"Feedback"}),Object(i.jsxs)("div",{children:[Object(i.jsx)("textarea",{className:"form-control no-input-shadow",onChange:this.OnChangeFeedback,value:this.state.feedback_text,disabled:this.state.is_valid_feedback}),this.state.is_valid_feedback?Object(i.jsx)("div",{children:"Thanks for the feedback :) "}):Object(i.jsx)(v.a,{variant:"primary",className:"my-1 float-right",onClick:this.OnSubmitFeedback,disabled:this.state.is_feedback_btn_disabled,children:"Submit"})]})]})]})})})}}]),n}(a.Component),Se=Object(A.b)((function(e){return{user:e.user}}),(function(){return{}}))(Ce);z.a.initialize(T.GOOGLE_ANALYTICS_UA);var ye=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).state={pin_code:"",district_id:"1",is_valid_pin_code:!1,vaccine:"",vaccine_date:I()().format("YYYY-MM-DD"),states:[],districts:[],show_modal:!1,modal_text:"",can_show_tracking_center_button:!1},i.options={headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+i.props.user.token}},i.GaEventTracker=H(),z.a.pageview(window.location.pathname+window.location.search),i.GetState=i.GetState.bind(Object(p.a)(i)),i.OnChangeState=i.OnChangeState.bind(Object(p.a)(i)),i.OnChangeDate=i.OnChangeDate.bind(Object(p.a)(i)),i.OnChangePinCode=i.OnChangePinCode.bind(Object(p.a)(i)),i.OnChangeDistrictCode=i.OnChangeDistrictCode.bind(Object(p.a)(i)),i.OnChangeVaccine=i.OnChangeVaccine.bind(Object(p.a)(i)),i.SelectVaccinesWithDate=i.SelectVaccinesWithDate.bind(Object(p.a)(i)),i.OnSubmitPinCode=i.OnSubmitPinCode.bind(Object(p.a)(i)),i.OnSubmitDistrict=i.OnSubmitDistrict.bind(Object(p.a)(i)),i.OnGetCenterCallback=i.OnGetCenterCallback.bind(Object(p.a)(i)),i.OnLogout=i.OnLogout.bind(Object(p.a)(i)),i.onSubscriptionResponseCallback=i.onSubscriptionResponseCallback.bind(Object(p.a)(i)),i.closeModal=i.closeModal.bind(Object(p.a)(i)),i}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.GetState(),this.OnChangeState(1),this.CheckHealth()}},{key:"CheckHealth",value:function(){var e=this,t=T.BACKEND_BASE_URL+X.HEALTH_CHECK,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};N.a.post(t,{},n).then((function(t){e.GetUser(),e.props.setServerStat(!0)})).catch((function(t){e.props.setToken(null),e.props.setSubscriptions([]),void 0===t.response||403!==t.response.status?e.props.setServerStat(!1):e.props.setServerStat(!0),console.log(t)}))}},{key:"GetState",value:function(){var e=this;N.a.get(T.COWIN_BASE_URL+y.GET_STATES,this.options).then((function(t){200===t.status&&t.data.states.length>0?e.setState({states:t.data.states}):console.log(t)})).catch((function(e){return console.error(e)}))}},{key:"OnChangeState",value:function(e){var t=this;N.a.get(T.COWIN_BASE_URL+y.GET_DISTRICT.replace("<DISTRICT>",e),this.options).then((function(e){200===e.status&&e.data.districts.length>0?t.setState({districts:e.data.districts}):console.error(e)})).catch((function(e){return console.error(e)}))}},{key:"OnChangeDistrictCode",value:function(e){this.setState({district_id:e})}},{key:"OnSubmitPinCode",value:function(){if(6===this.state.pin_code.length){this.GaEventTracker("Pin code Submitted",this.state.pin_code);var e=I()(this.state.vaccine_date).format("DD-MM-YYYY");de(T.COWIN_BASE_URL+y.CALENDAR_BY_PIN_CODE.replace("<PINCODE>",this.state.pin_code).replace("<DATE>",e).replace("<VACCINE>",this.state.vaccine),this.OnGetCenterCallback)}}},{key:"OnSubmitDistrict",value:function(){if(!(this.state.district_id.length<=0)){this.GaEventTracker("District Submitted",this.state.pin_code);var e=I()(this.state.vaccine_date).format("DD-MM-YYYY");de(T.COWIN_BASE_URL+y.CALENDAR_BY_DISTRICT.replace("<DISTRICT_ID>",this.state.district_id).replace("<DATE>",e).replace("<VACCINE>",this.state.vaccine),this.OnGetCenterCallback)}}},{key:"OnGetCenterCallback",value:function(e){this.props.setCenters(e),this.GaEventTracker("Received Centers"),e.length>0&&!this.IsTrackingContains(Number(this.state.pin_code))&&this.setState({can_show_tracking_center_button:!0})}},{key:"OnChangeVaccine",value:function(e){this.setState({vaccine:e.target.value})}},{key:"OnChangeDate",value:function(e){this.setState({vaccine_date:e.target.value}),this.GetVaccineSessionChild.current.OnChangeDate(e.target.value)}},{key:"OnChangePinCode",value:function(e){var t=e.target.value.replace(/^0+/,"");this.setState({pin_code:t,can_show_tracking_center_button:!1,is_valid_pin_code:6===e.target.value.length})}},{key:"SelectVaccinesWithDate",value:function(){return Object(i.jsxs)("div",{children:[Object(i.jsxs)("select",{className:"form-control no-input-shadow mt-2",value:this.state.vaccine,onChange:this.OnChangeVaccine,children:[Object(i.jsx)("option",{value:"",children:"All Vaccine"}),Object(i.jsx)("option",{value:w.COVAXIN,children:w.COVAXIN}),Object(i.jsx)("option",{value:w.COVISHIELD,children:w.COVISHIELD})]}),Object(i.jsx)(g.a,{className:"no-input-shadow mt-2",placeholder:"Enter start date",type:"date",value:this.state.vaccine_date,onChange:this.OnChangeDate})]})}},{key:"OnLogout",value:function(){var e=this,t=T.BACKEND_BASE_URL+X.LOGOUT_URL,n={headers:{"Content-Type":"application/json",Authorization:"Token "+this.props.user.token}};N.a.post(t,{},n).then((function(t){e.props.setToken(null),e.props.setSubscriptions([])})).catch((function(e){console.log(e)}))}},{key:"closeModal",value:function(){this.setState({show_modal:!1})}},{key:"onSubscriptionResponseCallback",value:function(e){this.setState({show_modal:!0,modal_text:e})}},{key:"render",value:function(){var e=this;return Object(i.jsxs)(_.a,{className:"",children:[Object(i.jsx)("div",{className:"position-relative",children:null!==this.props.user.token&&Object(i.jsx)(v.a,{variant:"danger",className:"position-absolute shadow-lg logout-btn",onClick:this.OnLogout,children:"Logout"})}),Object(i.jsxs)(f.a,{defaultActiveKey:"map",transition:!1,id:"noanim-tab-example",className:"bg-white rounded-top shadow overflow-hidden mt-4 position-relative",children:[Object(i.jsx)(k.a,{eventKey:"map",title:"Near Me",children:Object(i.jsxs)("div",{className:"bg-white mb-2 rounded-bottom bg-cowin2-light shadow p-2",children:[null===this.props.user.token&&Object(i.jsx)("div",{className:"p-3 shadow rounded-lg bg-warning my-2",children:"Use google login and subscribe SMS text to get more accurate notification even you're offline."}),Object(i.jsx)(he,{addToTracking:this.AddToTracking,isTrackingContains:this.IsTrackingContains,getUser:this.GetUser,onSubscriptionResponseCallback:this.onSubscriptionResponseCallback})]})}),Object(i.jsx)(k.a,{eventKey:"home",title:"Pin code",children:Object(i.jsx)("div",{className:"bg-white mb-2 rounded-bottom bg-cowin2-light shadow p-4 justify-content-center d-flex align-items-center",style:{height:300},children:Object(i.jsxs)("div",{className:"col-md-6",children:[Object(i.jsx)(g.a,{className:"no-input-shadow",placeholder:"Enter pin code",type:"number",value:this.state.pin_code,onChange:this.OnChangePinCode}),this.state.can_show_tracking_center_button&&Object(i.jsx)(v.a,{variant:"outline-success",className:"small py-0 rounded-0 float-right mb-1",style:{top:0,right:"-10%"},onClick:function(){e.AddToTracking(Number(e.state.pin_code))},children:"Track this pincode"}),Object(i.jsx)(this.SelectVaccinesWithDate,{}),Object(i.jsx)(v.a,{variant:"primary",className:"form-control mt-4",onClick:this.OnSubmitPinCode,disabled:!this.state.is_valid_pin_code,children:" Find vaccine slots"})]})})}),Object(i.jsx)(k.a,{eventKey:"profile",title:"District",children:Object(i.jsx)("div",{className:"bg-white mb-2 rounded-bottom shadow p-4 justify-content-center d-flex align-items-center",style:{height:300},children:Object(i.jsxs)("div",{className:"col-md-6",children:[Object(i.jsx)("select",{className:"form-control no-input-shadow",placeholder:"Select state",onChange:function(t){e.OnChangeState(t.target.value)},children:this.state.states.map((function(e){return Object(i.jsx)("option",{value:e.state_id,children:e.state_name},e.state_id)}))}),Object(i.jsx)("select",{className:"form-control no-input-shadow mt-2",placeholder:"Select district",value:this.state.district_id,onChange:function(t){e.OnChangeDistrictCode(t.target.value)},children:this.state.districts.map((function(e){return Object(i.jsx)("option",{value:e.district_id,children:e.district_name},e.district_id)}))}),Object(i.jsx)(this.SelectVaccinesWithDate,{}),Object(i.jsx)(v.a,{variant:"primary",className:"form-control mt-4",onClick:this.OnSubmitDistrict,children:" Find vaccine slots"})]})})}),Object(i.jsx)(k.a,{eventKey:"near_me",title:"Subscriptions",children:Object(i.jsxs)("div",{className:"bg-white mb-2 rounded-bottom shadow p-4 justify-content-center d-flex",children:[this.props.user.is_server_up&&Object(i.jsx)("div",{className:"p-1",children:Object(i.jsx)(ce,{getUser:this.GetUser})}),Object(i.jsx)("div",{className:"p-1",children:Object(i.jsx)(be,{removeFromTracking:this.RemoveFromTracking})})]})})]}),Object(i.jsx)(W,{}),Object(i.jsx)(ke,{showModal:this.state.show_modal,textBody:this.state.modal_text,handleClose:this.closeModal}),Object(i.jsxs)(C.a,{className:"mt-1",children:[Object(i.jsx)(S.a,{className:"",md:6,children:Object(i.jsx)(be,{removeFromTracking:this.RemoveFromTracking})}),Object(i.jsx)(S.a,{className:"my-1",md:6,children:Object(i.jsx)("a",{href:"https://dashboard.cowin.gov.in/",target:"_blank",rel:"noreferrer",children:Object(i.jsx)("div",{style:{width:"100%",height:"100%",backgroundImage:"url('https://www.dpma.de/images/istock/46-50/istock-494497554_goir_gross.jpg')",backgroundPosition:"center",backgroundSize:"cover"},children:Object(i.jsx)(v.a,{style:{width:"100%",height:"100%",background:"rgba(0,0,0, 0.6)"},className:"shadow p-4 font-weight-bold",children:"Cowin Dashboard & Statistics"})})})})]}),Object(i.jsx)(Se,{})]})}}]),n}(ve),xe=Object(A.b)((function(e){return{user:e.user,vaccine:e.vaccine}}),(function(e){return{setToken:function(t){return e(L(t))},setCenters:function(t){return e(function(e){return{type:te,payload:e}}(t))},setServerStat:function(t){return e(function(e){return{type:R,payload:e}}(t))},setSubscriptions:function(t){return e(M(t))},setTrackingCenters:function(t){return e(se(t))}}}))(ye),Ne=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;!function(){var e=Ne.open("cowin",T.DB_VERSION);e.onupgradeneeded=function(t){var n=e.result;n.objectStoreNames.contains("centers")?t.oldVersion&&(n.deleteObjectStore("centers"),n.createObjectStore("centers",{keyPath:"pin_code"}).createIndex("pin_code","pin_code",{unique:!0})):n.createObjectStore("centers",{keyPath:"pin_code"}).createIndex("pin_code","pin_code",{unique:!0})},e.onsuccess=function(t){e.result.objectStoreNames.contains("centers")||Ne.deleteDatabase("cowin")}}(),Object(me.initDB)(Oe);var Te=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).state={is_location_granted:!0,top_notification_content:"Grant notification permission manually, to notify if any slots available. Not required in case of SMS notification."},i.OnNotificationPermissionChange=i.OnNotificationPermissionChange.bind(Object(p.a)(i)),i}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(){e.CheckForNotificationPermission()}),(function(t){t.PERMISSION_DENIED&&e.setState({is_location_granted:!1,top_notification_content:"Allow location manually, to get centers nearby you"})})):(this.setState({is_location_granted:!1,top_notification_content:"Location is not supported by your browser"}),this.CheckForNotificationPermission())}},{key:"CheckForNotificationPermission",value:function(){this.IsPushNotificationSupported()?"denied"!==Notification.permission&&"default"!==Notification.permission||(this.OnNotificationPermissionChange(),Notification.requestPermission(this.OnNotificationPermissionChange).then((function(e){}))):this.setState({is_location_granted:!1,top_notification_content:"Notifications are not supported by your browser"})}},{key:"OnNotificationPermissionChange",value:function(){"denied"===Notification.permission&&this.setState({is_location_granted:!1})}},{key:"IsPushNotificationSupported",value:function(){return"serviceWorker"in navigator&&"PushManager"in window}},{key:"render",value:function(){return Object(i.jsxs)("div",{className:"App",children:[!this.state.is_location_granted&&Object(i.jsx)("div",{className:"bg-danger text-center text-white",children:this.state.top_notification_content}),Object(i.jsx)(O.a,{children:Object(i.jsx)(j.c,{children:Object(i.jsx)(j.a,{path:"",exact:!0,component:xe})})})]})}}]),n}(a.Component),we=n(28),Ee=n(65),Ie=n(81),Ae=n.n(Ie),De=n(11),Re={is_server_up:!0,token:null,subscriptions:[]},Be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return Object(De.a)(Object(De.a)({},e),{},{token:t.payload});case R:return Object(De.a)(Object(De.a)({},e),{},{is_server_up:t.payload});case B:return Object(De.a)(Object(De.a)({},e),{},{subscriptions:t.payload});default:return e}},Le="SET_LATITUDE",Me="SET_LONGITUDE",Ue={latitude:100,longitude:157},Ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Le:return Object(De.a)(Object(De.a)({},e),{},{latitude:t.payload});case Me:return Object(De.a)(Object(De.a)({},e),{},{longitude:t.payload});default:return e}},Pe={centers:[],nearby_centers:[],is_centers_updated:!1,tracking_centers:[]},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(t.type){case te:return Object(De.a)(Object(De.a)({},e),{},{centers:t.payload,is_centers_updated:!0});case ae:return Object(De.a)(Object(De.a)({},e),{},{nearby_centers:t.payload});case ne:return Object(De.a)(Object(De.a)({},e),{},{tracking_centers:t.payload});case ie:return Object(De.a)(Object(De.a)({},e),{},{is_centers_updated:t.payload});default:return e}},We=Object(we.b)({user:Be,position:Ge,vaccine:Fe}),Ye={key:"root",storage:Ae.a,blacklist:["vaccine"]},Ve=Object(Ee.a)(Ye,We),Ke=Object(we.c)(Ve),ze=Object(Ee.b)(Ke),He=n(82),qe=n(37),Je=n(64),Xe=n(29);qe.b.add(Je.b,Xe.i,Xe.c,Xe.a,Xe.f,Xe.g,Xe.e,Xe.h,Xe.b,Je.a,Xe.d),c.a.render(Object(i.jsx)(s.a.StrictMode,{children:Object(i.jsx)(A.a,{store:Ke,children:Object(i.jsxs)(He.a,{loading:null,persistor:ze,children:[Object(i.jsx)(O.a,{}),Object(i.jsx)(Te,{})]})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");r?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):l(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):l(t,e)}))}}(),d()},19:function(e){e.exports=JSON.parse('{"GET_USER_INFO":"/api/user/","LOGOUT_URL":"/api/logout/","GET_TOKEN_URL":"/api/authentication/exchange/google-oauth2","NOTIFICATION_SUBSCRIBED_URL":"/api/user/subscribe/","NOTIFICATION_UNSUBSCRIBED_URL":"/api/user/unsubscribe/","ADD_PIN_CODE_URL":"/api/user/pincode/add/","REMOVE_PIN_CODE_URL":"/api/user/pincode/remove/","SYNC_PIN_CODE_URL":"/api/user/pincode/sync/","HEALTH_CHECK":"/api/health/check/","USER_FEEDBACK":"/api/user/feedback/"}')},27:function(e){e.exports=JSON.parse('{"COWIN_REGISTRATION":"https://selfregistration.cowin.gov.in/","SUBSCRIPTION_WA":"WA","SUBSCRIPTION_BR":"BR"}')},30:function(e){e.exports=JSON.parse('{"REGISTER_OTP":"/v2/auth/generateOTP","CONFIRM_OTP":"/v2/auth/confirmOTP","GET_STATES":"/v2/admin/location/states","GET_DISTRICT":"/v2/admin/location/districts/<DISTRICT>","CALENDAR_BY_PIN_CODE":"/v2/appointment/sessions/public/calendarByPin?pincode=<PINCODE>&date=<DATE>&vaccine=<VACCINE>","CALENDAR_BY_DISTRICT":"/v2/appointment/sessions/public/calendarByDistrict?district_id=<DISTRICT_ID>&date=<DATE>&vaccine=<VACCINE>","CENTERS_BY_LAT_LONG":"/v2/appointment/centers/public/findByLatLong?lat=<LAT>&long=<LONG>"}')},46:function(e){e.exports=JSON.parse('{"COVISHIELD":"COVISHIELD","COVAXIN":"COVAXIN"}')},8:function(e){e.exports=JSON.parse('{"COWIN_BASE_URL":"https://cdn-api.co-vin.in/api","BACKEND_BASE_URL":"https://notifyslot-backend.online","GMAIL_API_CLIENT_ID":"262189712583-00tmf16i31b5dgievcav04912pdqjs80.apps.googleusercontent.com","GOOGLE_ANALYTICS_UA":"UA-196979850-1","GOOGLE_MAP_API":"AIzaSyBBwvwTMgYVzcSUojddLQA4VtTwUmAtH3o","DB_VERSION":5}')},90:function(e,t,n){},91:function(e,t,n){}},[[121,1,2]]]);
//# sourceMappingURL=main.478bf25d.chunk.js.map